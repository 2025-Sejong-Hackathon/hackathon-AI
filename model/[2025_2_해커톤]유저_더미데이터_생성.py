# -*- coding: utf-8 -*-
"""[2025-2 í•´ì»¤í†¤]ìœ ì € ë”ë¯¸ë°ì´í„° ìƒì„±.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1gALHwjMSMHzctHP1gbNLsc4NsuNWlyY4
"""

import json
import random
import itertools

# -----------------------------------------------------------
# 1. ì„¤ì •: í•™ê³¼ ë¦¬ìŠ¤íŠ¸ ë° ìƒìˆ˜
# -----------------------------------------------------------
MAJORS = [
    "êµ­ì–´êµ­ë¬¸í•™ê³¼", "êµ­ì œí•™ë¶€", "ì—­ì‚¬í•™ê³¼", "êµìœ¡í•™ê³¼", "ê¸€ë¡œë²Œì¸ì¬í•™ë¶€",
    "í–‰ì •í•™ê³¼", "ë¯¸ë””ì–´ì»¤ë®¤ë‹ˆì¼€ì´ì…˜í•™ê³¼", "ë²•í•™ê³¼",
    "ê²½ì˜í•™ë¶€", "ê²½ì œí•™ê³¼",
    "í˜¸í…”ê´€ê´‘ì™¸ì‹ê²½ì˜í•™ë¶€", "í˜¸í…”ì™¸ì‹ê´€ê´‘í”„ëœì°¨ì´ì¦ˆê²½ì˜í•™ê³¼", "ê¸€ë¡œë²Œì¡°ë¦¬í•™ê³¼", "í˜¸í…”ì™¸ì‹ë¹„ì¦ˆë‹ˆìŠ¤í•™ê³¼",
    "ìˆ˜í•™í†µê³„í•™ê³¼", "ë¬¼ë¦¬ì²œë¬¸í•™ê³¼", "í™”í•™ê³¼",
    "ìƒëª…ì‹œìŠ¤í…œí•™ë¶€", "ìŠ¤ë§ˆíŠ¸ìƒëª…ì‚°ì—…ìœµí•©í•™ê³¼",
    "AIìœµí•©ì „ìê³µí•™ê³¼", "ë°˜ë„ì²´ì‹œìŠ¤í…œê³µí•™ê³¼", "ì»´í“¨í„°ê³µí•™ê³¼", "ì •ë³´ë³´í˜¸í•™ê³¼", "ì–‘ìì§€ëŠ¥ì •ë³´í•™ê³¼", "ì°½ì˜ì†Œí”„íŠ¸í•™ë¶€", "ì§€ëŠ¥IoTí•™ê³¼",
    "ì‚¬ì´ë²„êµ­ë°©í•™ê³¼", "êµ­ë°©AIë¡œë´‡ìœµí•©ê³µí•™ê³¼", "ì¸ê³µì§€ëŠ¥ë°ì´í„°ì‚¬ì´ì–¸ìŠ¤í•™ê³¼", "AIë¡œë´‡í•™ê³¼", "ì§€ëŠ¥ì •ë³´ìœµí•©í•™ê³¼", "ì½˜í…ì¸ ì†Œí”„íŠ¸ì›¨ì–´í•™ê³¼",
    "ê±´ì¶•ê³µí•™ê³¼", "ê±´ì¶•í•™ê³¼", "ê±´ì„¤í™˜ê²½ê³µí•™ê³¼", "í™˜ê²½ìœµí•©ê³µí•™ê³¼", "ì§€êµ¬ìì›ì‹œìŠ¤í…œê³µí•™ê³¼", "ê¸°ê³„ê³µí•™ê³¼",
    "ìš°ì£¼í•­ê³µì‹œìŠ¤í…œê³µí•™ë¶€", "ë‚˜ë…¸ì‹ ì†Œì¬ê³µí•™ê³¼", "ì–‘ìì›ìë ¥ê³µí•™ê³¼", "êµ­ë°©ì‹œìŠ¤í…œê³µí•™ê³¼",
    "íšŒí™”ê³¼", "íŒ¨ì…˜ë””ìì¸í•™ê³¼", "ìŒì•…ê³¼", "ì²´ìœ¡í•™ê³¼", "ë¬´ìš©ê³¼", "ì˜í™”ì˜ˆìˆ í•™ê³¼",
    "ììœ ì „ê³µí•™ë¶€", "ì¸ë¬¸ì‚¬íšŒê³„ì—´", "ê²½ìƒí˜¸í…”ê´€ê´‘ê³„ì—´", "ìì—°ìƒëª…ê³„ì—´", "ITê³„ì—´", "ì²¨ë‹¨ìœµí•©ê³„ì—´", "ê³µê³¼ê³„ì—´"
]

TOTAL_USERS = 1000  # ìƒì„±í•  ì´ ì¸ì› ìˆ˜

# -----------------------------------------------------------
# 2. ê¸°ëŠ¥ í•¨ìˆ˜: 16ê°€ì§€ ìœ í˜•(MBTIì‹) ìƒí™œ íŒ¨í„´ ìƒì„±ê¸°
# -----------------------------------------------------------
def generate_lifestyle_profile():
    """
    16ê°€ì§€ ìœ í˜• ì¤‘ í•˜ë‚˜ë¥¼ ëœë¤ìœ¼ë¡œ ê³¨ë¼, ì•½ê°„ì˜ ë…¸ì´ì¦ˆë¥¼ ì„ì€ ìƒí™œ íŒ¨í„´ ë”•ì…”ë„ˆë¦¬ë¥¼ ë°˜í™˜
    """
    # 4ê°€ì§€ ì¶•: [Time, Hygiene, Sensitivity, Social] (0 or 1)
    # ìœ í˜• ëœë¤ ì„ íƒ (ê· ë“± ë¶„í¬)
    t_axis = random.choice([0, 1]) # 0: Morning, 1: Night
    h_axis = random.choice([0, 1]) # 0: Clean, 1: Dirty
    s_axis = random.choice([0, 1]) # 0: Sensitive, 1: Tough(ë¬´ë˜)
    o_axis = random.choice([0, 1]) # 0: Introvert, 1: Extrovert

    noise = 0.1 # 10% í™•ë¥ ë¡œ ì˜ˆì™¸ í–‰ë™

    profile = {}

    # (1) Time Axis (Morning=0 vs Night=1)
    base = t_axis
    profile['sleep_habit'] = base if random.random() > noise else 1-base
    profile['wake_up'] = 0 if t_axis == 1 else 1 # Night(1)ì´ë©´ ì˜¤ì „ì—†ìŒ(0)
    if random.random() < noise: profile['wake_up'] = 1 - profile['wake_up']
    profile['activity_time'] = base if random.random() > noise else 1-base

    # (2) Hygiene Axis (Clean=0 vs Dirty=1)
    # ì§ˆë¬¸ ë¡œì§: clean_immediate(1=ë°”ë¡œ, 0=ë‚˜ì¤‘), desk_status(1=ì •ë¦¬, 0=ë”ëŸ¬ì›€)
    # Dirty(1)ì´ë©´ -> 0(ë‚˜ì¤‘/ë”ëŸ¬ì›€)ì´ ë‚˜ì™€ì•¼ í•¨. Clean(0)ì´ë©´ -> 1
    h_val = 0 if h_axis == 1 else 1
    profile['clean_immediate'] = h_val if random.random() > noise else 1-h_val
    profile['desk_status'] = h_val if random.random() > noise else 1-h_val

    # clean_cycle: Dirty(1) -> 2 or 3 / Clean(0) -> 0 or 1
    if h_axis == 1:
        profile['clean_cycle'] = random.choice([2, 3])
    else:
        profile['clean_cycle'] = random.choice([0, 1])

    # (3) Sensitivity Axis (Sensitive=0? No, ì§ˆë¬¸ìƒ 1=ì˜ˆë¯¼, 0=ë¬´ë˜)
    # Sensitive(0) -> ì‹¤ì œê°’ 1 / Tough(1) -> ì‹¤ì œê°’ 0
    s_val = 1 if s_axis == 0 else 0

    sens_cols = ['out_return', 'other_seat_tol', 'phone_noise',
                 'light_sensitivity', 'key_mouse_noise', 'space_privacy']
    for col in sens_cols:
        profile['out_return'] = s_val if random.random() > noise else 1-s_val
        profile[col] = s_val if random.random() > noise else 1-s_val

    # ì•ŒëŒ: ì˜ˆë¯¼(1)í•˜ë©´ ë°”ë¡œ ë”(1) / ë‘”í•˜ë©´ ëª»ë“¤ìŒ(0)
    profile['alarm_habit'] = s_val if random.random() > noise else 1-s_val

    # (4) Social Axis (Introvert=0 vs Extrovert=1)
    # ì§ˆë¬¸: 1=ì¹œëª©/ì´ˆëŒ€OK, 0=ê±°ë¦¬ë‘ê¸°/ì‹«ìŒ
    o_val = 1 if o_axis == 1 else 0
    profile['social_willingness'] = o_val if random.random() > noise else 1-o_val
    profile['friend_invite'] = o_val if random.random() > noise else 1-o_val

    # ê¸°ìˆ™ì‚¬ ì²´ë¥˜: Intro(0) -> 1(ë§ì´ìˆìŒ) / Extro(1) -> 0(ì ë§Œ)
    d_val = 1 if o_axis == 0 else 0
    profile['dorm_stay'] = d_val if random.random() > noise else 1-d_val

    return profile

# -----------------------------------------------------------
# 3. ë©”ì¸ ë°ì´í„° ìƒì„± ë¡œì§
# -----------------------------------------------------------
def create_mock_users(TOTAL_USERS):
    users = []
    generated_ids = set()

    # í•™ë²ˆ ê°€ì¤‘ì¹˜ ì„¤ì • (26í•™ë²ˆì´ ê°€ì¥ ë§ê³ , 20í•™ë²ˆìœ¼ë¡œ ê°ˆìˆ˜ë¡ ì¤„ì–´ë“¦)
    # Years: 26, 25, 24, 23, 22, 21, 20
    years = [26, 25, 24, 23, 22, 21, 20]
    weights = [30, 25, 15, 12, 8, 6, 4] # í•© 100ì´ ë˜ë„ë¡ ëŒ€ëµ ì„¤ì •

    for _ in range(TOTAL_USERS):
        user = {}

        # 1. í•™ë²ˆ ìƒì„± (Unique ë³´ì¥)
        while True:
            year = random.choices(years, weights=weights, k=1)[0]
            rand_suffix = random.randint(0, 1999) # 2000 ì´í•˜ ëœë¤
            student_id = f"{year}01{rand_suffix:04d}"

            if student_id not in generated_ids:
                generated_ids.add(student_id)
                break

        user['student_id'] = student_id

        # 2. ë‚˜ì´ ê³„ì‚° (í‰ê· ë³´ë‹¤ 1ì‚´ ë†’ê²Œ)
        # 26í•™ë²ˆ(1í•™ë…„) -> ë³´í†µ 20ì‚´. +1ì‚´ ë³´ì • = 21ì‚´ ê¸°ì¤€.
        # ê¸°ì¤€ ë‚˜ì´ = (27 - year) + 20
        base_age = (26 - year) + 21

        # ì•½ê°„ì˜ ë³€ë™ (ë¹ ë¥¸ë…„ìƒ or Nìˆ˜) : -1 ~ +2
        age_variation = random.choice([-1, 0, 0, 1, 1, 2])
        final_age = base_age + age_variation

        # ë²”ìœ„ ì œí•œ (20 ~ 27)
        if final_age < 20: final_age = 20
        if final_age > 27: final_age = 27
        user['age'] = final_age

        # 3. ê¸°ë³¸ ì •ë³´
        user['gender'] = random.choice(['ë‚¨ì„±', 'ì—¬ì„±'])
        user['major'] = random.choice(MAJORS)

        # 4. ì¶”ê°€ í˜¸ë¶ˆí˜¸ ì •ë³´ (O/X -> Boolean)
        user['is_smoker'] = random.choice([True, False])
        user['wants_smoker'] = random.choice([True, False]) # í¡ì—° ë£¸ë©” ê°€ëŠ¥?
        user['is_drinker'] = random.choice([True, False])
        user['wants_drinker'] = random.choice([True, False]) # ìŒì£¼ ë£¸ë©” ê°€ëŠ¥?
        user['sensitive_heat'] = random.choice([True, False]) # ë”ìœ„
        user['sensitive_cold'] = random.choice([True, False]) # ì¶”ìœ„

        # 5. ìƒí™œ íŒ¨í„´ (16 Q&A) ë³‘í•©
        lifestyle = generate_lifestyle_profile()
        user.update(lifestyle) # user ë”•ì…”ë„ˆë¦¬ì— í•©ì¹˜ê¸°

        users.append(user)

    return users

# -----------------------------------------------------------
# 4. ì‹¤í–‰ ë° JSON ì €ì¥
# -----------------------------------------------------------
mock_data = create_mock_users(TOTAL_USERS)

# íŒŒì¼ë¡œ ì €ì¥
file_path = 'dormitory_users.json'
with open(file_path, 'w', encoding='utf-8') as f:
    json.dump(mock_data, f, ensure_ascii=False, indent=4)

print(f"âœ… ì´ {len(mock_data)}ëª…ì˜ ë°ì´í„°ë¥¼ ìƒì„±í•˜ì—¬ '{file_path}'ë¡œ ì €ì¥í–ˆìŠµë‹ˆë‹¤.")

# ë¯¸ë¦¬ë³´ê¸° (ìƒìœ„ 1ëª…)
print("\n[ë°ì´í„° ë¯¸ë¦¬ë³´ê¸° (1ëª…)]")
print(json.dumps(mock_data[0], ensure_ascii=False, indent=4))

import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.decomposition import PCA
from sklearn.preprocessing import StandardScaler

# í•œê¸€ í°íŠ¸ ì„¤ì • (Mac: 'AppleGothic', Win: 'Malgun Gothic')
plt.rcParams['font.family'] = 'Malgun Gothic'
plt.rcParams['axes.unicode_minus'] = False

def visualize_data_quality(df):
    # 'type_label'ì€ ë¶„ì„ì—ì„œ ì œì™¸í•˜ê³  ì •ë‹µì§€ë¡œ ë”°ë¡œ ëºŒ
    X = df.drop(columns=['type_label'])
    y = df['type_label']

    # -------------------------------------------------------
    # 1. íˆíŠ¸ë§µ (Heatmap): ìœ í˜•ë³„ íŠ¹ì§•ì´ ëšœë ·í•œê°€?
    # -------------------------------------------------------
    # ìœ í˜•ë³„ í‰ê· ê°’ ê³„ì‚°
    type_means = df.groupby('type_label').mean()

    # ì‹œê°í™”
    plt.figure(figsize=(14, 10))
    sns.heatmap(type_means, cmap='RdBu_r', annot=False, linewidths=.5)
    plt.title('16ê°œ ìœ í˜•ë³„ ì„¤ë¬¸ ì‘ë‹µ íŒ¨í„´ (íŒŒë€ìƒ‰=ë‚®ìŒ/0, ë¹¨ê°„ìƒ‰=ë†’ìŒ/1)', fontsize=15)
    plt.xlabel('ì„¤ë¬¸ ë¬¸í•­', fontsize=12)
    plt.ylabel('ìœ í˜• (Type)', fontsize=12)
    plt.show()

    print("\n--- [íˆíŠ¸ë§µ í•´ì„ íŒ] ---")
    print("1. ê°€ë¡œì¤„(ìœ í˜•)ë§ˆë‹¤ ìƒ‰ê¹” íŒ¨í„´ì´ ëšœë ·í•˜ê²Œ ë‹¬ë¼ì•¼ í•©ë‹ˆë‹¤.")
    print("2. ì˜ˆë¥¼ ë“¤ì–´ 'M...(ì•„ì¹¨í˜•)'ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ìœ í˜•ë“¤ì€ sleep_habit(ìˆ˜ë©´ì‹œê°„)ì´ íŒŒë€ìƒ‰(0)ì´ì–´ì•¼ í•©ë‹ˆë‹¤.")
    print("3. ìƒ‰ê¹”ì´ ë’¤ì£½ë°•ì£½ ì„ì—¬ìˆì§€ ì•Šê³ , ë¸”ë¡ í˜•íƒœ(ì²´í¬ë¬´ëŠ¬)ê°€ ë³´ì´ë©´ ì„±ê³µì…ë‹ˆë‹¤.")

    # -------------------------------------------------------
    # 2. PCA ì‚°ì ë„ (Scatter Plot): ë°ì´í„°ê°€ ì˜ ë¶„ë¦¬ë˜ëŠ”ê°€?
    # -------------------------------------------------------
    # ë°ì´í„° ì •ê·œí™” (ìŠ¤ì¼€ì¼ë§)
    scaler = StandardScaler()
    X_scaled = scaler.fit_transform(X)

    # 2ì°¨ì›ìœ¼ë¡œ ì°¨ì› ì¶•ì†Œ
    pca = PCA(n_components=2)
    components = pca.fit_transform(X_scaled)

    # ë°ì´í„°í”„ë ˆì„ìœ¼ë¡œ ë³€í™˜
    pca_df = pd.DataFrame(data=components, columns=['PC1', 'PC2'])
    pca_df['Type'] = y.values

    # ìœ í˜•ì˜ ì•ê¸€ì(M/N: ìˆ˜ë©´íŒ¨í„´)ë§Œ ë”°ì„œ ëª¨ì–‘ìœ¼ë¡œ êµ¬ë¶„í•´ë³´ê¸°
    pca_df['Sleep_Type'] = pca_df['Type'].apply(lambda x: x[0])

    plt.figure(figsize=(12, 8))
    sns.scatterplot(
        x='PC1', y='PC2',
        hue='Type',           # ìƒ‰ê¹”ì€ 16ê°œ ìœ í˜• ì „ì²´
        style='Sleep_Type',   # ëª¨ì–‘ì€ ì•„ì¹¨í˜•/ì €ë…í˜• êµ¬ë¶„
        data=pca_df,
        palette='tab20',      # ë‹¤ì–‘í•œ ìƒ‰ìƒ íŒ”ë ˆíŠ¸
        s=100,                # ì  í¬ê¸°
        alpha=0.8             # íˆ¬ëª…ë„
    )
    plt.title('16ê°œ ìœ í˜• ë°ì´í„° ë¶„í¬ (PCA ì°¨ì›ì¶•ì†Œ)', fontsize=15)
    plt.legend(bbox_to_anchor=(1.05, 1), loc=2, borderaxespad=0.)
    plt.tight_layout()
    plt.show()

    print("\n--- [ì‚°ì ë„ í•´ì„ íŒ] ---")
    print("1. ì ë“¤ì´ í•˜ë‚˜ì˜ í° ë©ì–´ë¦¬ë¡œ ë­‰ì³ìˆì§€ ì•Šê³ , ë¼ë¦¬ë¼ë¦¬ ë­‰ì³ìˆì–´ì•¼ í•©ë‹ˆë‹¤.")
    print("2. 16ê°œ ìƒ‰ê¹”ì´ ì™„ì „íˆ ë”°ë¡œ ë–¨ì–´ì§ˆ í•„ìš”ëŠ” ì—†ì§€ë§Œ, ìµœì†Œí•œ 4~5ê°œì˜ í° ê·¸ë£¹ì€ ë³´ì—¬ì•¼ í•©ë‹ˆë‹¤.")

# ì‹¤í–‰
visualize_data_quality(df_16types)

import pandas as pd

def show_data_summary(df):
    # 'type_label'ì„ ê¸°ì¤€ìœ¼ë¡œ ê·¸ë£¹ì„ ë¬¶ê³  í‰ê· ì„ ê³„ì‚°í•©ë‹ˆë‹¤.
    summary_df = df.groupby('type_label').mean().round(2)

    # ë³´ê¸° ì¢‹ê²Œ ì¸ì›ìˆ˜(count) ì»¬ëŸ¼ë„ ì¶”ê°€í•©ë‹ˆë‹¤.
    summary_df['count'] = df['type_label'].value_counts()

    # ë¶„ì„í•˜ê¸° í¸í•˜ê²Œ ì£¼ìš” ì»¬ëŸ¼ë§Œ ë½‘ì•„ì„œ ë´…ë‹ˆë‹¤ (ì›í•˜ë©´ ì „ì²´ë¥¼ ë´ë„ ë©ë‹ˆë‹¤)
    key_columns = [
        'sleep_habit', 'clean_immediate', 'phone_noise', 'social_willingness', # ê° ì¶•ì˜ ëŒ€í‘œ ë¬¸í•­
        'clean_cycle', # 0~3 ê°’ì„ ê°€ì§€ëŠ” íŠ¹ì´ ë¬¸í•­
        'count'        # ì¸ì› ìˆ˜
    ]

    print("\nğŸ“Š [16ê°œ ìœ í˜•ë³„ í‰ê·  ë°ì´í„° ì ê²€í‘œ]")
    print("-" * 60)
    # ì „ì²´ ì»¬ëŸ¼ì„ ë³´ê³  ì‹¶ìœ¼ë©´ key_columns ëŒ€ì‹  summary_df ë¥¼ ì¶œë ¥í•˜ì„¸ìš”.
    print(summary_df[key_columns])
    print("-" * 60)

    return summary_df

# ì‹¤í–‰
summary_table = show_data_summary(df_16types)